{% comment %}
	Include a grid of project page boxes for all *displayed* pages
	associated with a given project.

	By default, this widget assumes that it is included in a project
	homepage, and will use that page's information to determine which
	project pages to display. This can be overridden by passing in
	suitable page data as the `project` parameter.

	Note that this widget outputs HTML in a safe way, and is thus
	suitable for inclusion in both Markdown and HTML pages.
{% endcomment %}

{% comment %}
	Set the current project.
{% endcomment %}
{% assign project = include.project | default: page %}

{% comment %}
	Figure out the current project ID.
{% endcomment %}
{% assign project_id = project.url | replace: "/", " " | strip | split: " " | last %}

{% comment %}
	Generate a list of project pages associated with the current
	project.
{% endcomment %}
{% assign project_pages = "" | split: "" %}
{% for the_page in site.pages %}
	{% if the_page.layout == "page-project-page" %}
		{% assign path_array = the_page.url | replace: "/", " " | strip | split: " " %}
		{% if path_array[1] == project_id %}
			{% unless the_page.hidden %}
				{% assign project_pages = project_pages | push: the_page %}
			{% endunless %}
		{% endif %}
	{% endif %}
{% endfor %}
{% assign project_pages = project_pages | sort: "url" | sort: "date" %}

{% comment %}
	Output project pages (if they exist).

	Note that we need to eliminate the HTML indent in order to guard
	against Jekyll interpreting this as a code block.
{% endcomment %}
{% if project_pages.size > 0 %}
	{% capture the_content %}<section class="project-pages w-100 flex flex-wrap items-start">
		{% for pp in project_pages %}
			{% include project-page-box.html pp=pp %}
		{% endfor %}
	</section>{% endcapture %}
	{% include widget-breakout-box.html layout="full-bleed" extra_class="yak-project-page-list-wrapper" content=the_content %}
{% endif %}
