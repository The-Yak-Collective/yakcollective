{% comment %}
	Generate a slideshow layout, similar to that used on "Idle Words".
	Expects two parameters:

		`hero_position`
		OPTIONALLY force the slide "hero" image into a particular
		position (`left` or `right`). If not present, then use the
		`hero_position` attribute from the slide itself instead (and
		fall back to `left` if nothing is specified).

		`hero_align`
		OPTIONALLY force the slide "hero" image into a particular
		vertical alignment (`top`, `bottom`, or `center`). If not
		present, then use the `hero_align` attribute from the slide
		itself instead (and fall back to `center` if nothing is
		specified).

		`slide`
		An object containing the relevant slide information (basically,
		an element of `site.pages` that lives in the project-appropriate
		`/projects/*/` directory and has a `page-project-slide` layout).

	Note that this widget outputs HTML in a safe way, and is thus
	suitable for inclusion in both Markdown and HTML pages.
{% endcomment %}

{% comment %}
	Determine how we should align and position the slide "hero" image.
{% endcomment %}
{% assign hero_align = "center" %}
{% assign hero_position = "left" %}
{% if include.slide.hero_align %}
	{% assign hero_align = include.slide.hero_align %}
{% endif %}
{% if include.slide.hero_position %}
	{% assign hero_position = include.slide.hero_position %}
{% endif %}
{% if include.hero_align %}
	{% unless include.hero_align == "-" %}
		{% assign hero_align = include.hero_align %}
	{% endunless %}
{% endif %}
{% if include.hero_position %}
	{% unless include.hero_position == "-" %}
		{% assign hero_position = include.hero_position %}
	{% endunless %}
{% endif %}
{% if hero_align != "top" and hero_align != "center" and hero_align != "bottom" %}
	{% assign hero_align = "center" %}
{% endif %}
{% if hero_position != "left" and hero_position != "right" %}
	{% assign hero_position = "left" %}
{% endif %}
{% unless include.slide.hero_image %}
	{% assign hero_align = "none" %}
	{% assign hero_position = "none" %}
{% endunless %}

{% comment %}
	Regularize `hide_title` and `hide_author`.
{% endcomment %}
{% assign hide_title = false %}
{% if include.hide_title %}
	{% unless include.hide_title == "-" %}
		{% assign hide_title = true %}
	{% endunless %}
{% endif %}
{% assign hide_author = false %}
{% if include.hide_author %}
	{% unless include.hide_author == "-" %}
		{% assign hide_author = true %}
	{% endunless %}
{% endif %}

{% comment %}
	Push out slide content. Weird indenting is necessary so as not to
	mess with Kramdown's indentation expectations.
{% endcomment %}
{% capture the_content %}
<div{% if page.layout != "page-project-slide" %} id="{{ include.slide.url | replace: '/', ' ' | strip | replace: ' ', '-' }}"{% endif %} class="slide-image-{{ hero_position }} {% if hero_align == 'top' %}items-start{% elsif hero_align == 'bottom' %}items-end{% else %}items-center{% endif %} cf">
	<div class="slide-image {% if hero_position == 'left' %}mt5 mb0 mv5-l{% elsif hero_position == 'right' %}mt0 mb5 mv5-l{% endif %}">
		{% if include.slide.hero_image %}
			<figure class="ma0">
				<img src="{{ include.slide.hero_image }}"{% if include.slide.hero_description %} alt="{{ include.slide.hero.description | markdownify | strip_html | strip }}"{% endif %}{% if include.slide.hero_border %} class="image-border ba"{% endif %}>
				{% if include.slide.hero_caption %}
					<figcaption class="yak-content">
						{{ include.slide.hero_caption | markdownify }}
					</figcaption>
				{% endif %}
			</figure>
		{% endif %}
	</div>
	<div class="slide-content mv5">
		{% unless hide_title %}
			{% if page.layout == "page-project-slide" %}
				<h1>{{ include.slide.title }}</h1>
			{% else %}
				<h2><a href="{{ include.slide.url }}">{{ include.slide.title }}</a></h2>
			{% endif %}
		{% endunless %}

		{{ include.slide.content | markdownify }}

		{% unless hide_author %}
			{% if include.slide.author %}
				{% assign author_url = "/members/" | append: include.slide.author | append: "/" %}
				{% assign author = site.pages | find: "url", author_url %}
				{% if author %}
					<p class="slide-author">(<a href="{{ author.url }}">{{ author.title }}</a>)</p>
				{% endif %}
			{% endif %}
		{% endunless %}
	</div>
</div>
{% endcapture %}
{% include widget-breakout-box.html layout="full-bleed" extra_class="yak-slide-wrapper" content=the_content %}
