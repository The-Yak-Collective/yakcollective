---
layout: page
---

{% comment %}
	Used "posts" (newsletters and cached member blog posts) and project
	pages.

	Header links back to the off-site page (if applicable).

	Member card and short bio is appended.

	For project pages, also append a navigation tree of all project
	pages with `display: true`. If no such pages exist, this just serves
	as a link to return to the original project.
{% endcomment %}

{% comment %}
	Turn the page path into an array.
{% endcomment %}
{% assign path_array = page.url | replace: "/", " " | strip | split: " " %}

<h1>{% if page.original_link %}<a href="{{ page.original_link }}">{% endif %}{{ page.title }}{% if page.original_link %}</a>{% endif %}</h1>

{% comment %}
	Page `content`. We wrap this in a `yak-post` `<div/>` for regular
	"posts", as incoming HTML requires some normalization we don't need
	for pages we make ourselves.

{% endcomment %}
{% if path_array[0] != "writings" and path_array[0] != "newsletters" %}<div class="yak-post">{% endif %}{{ content }}{% if path_array[0] != "projects" %}</div>{% endif %}

{% comment %}
	If `page.author` is set, build our member list, locate the
	appropriate member data page, and display the member card (as well
	as the member `bio_short`, if it exists).
{% endcomment %}
{% if page.author %}
	{% assign members = "" | split: "" %}
	{% for the_page in site.pages %}
		{% assign path_array = the_page.url | replace: "/", " " | strip | split: " " %}
		{% assign path_size = path_array | size %}
		{% if path_array[0] == "members" and path_size == 2 %}
			{% assign members = members | push: the_page %}
		{% endif %}
	{% endfor %}
	{% assign author_file = page.author | append: ".md" %}
	{% assign member = members | where: "name", author_file | first %}
	{% include widget-member-card.html member=member %}
	{% if member.bio_short %}
		<div class="small ph2 pb1">
			{{ member.bio_short | markdownify }}
		</div>
	{% endif %}
{% endif %}

{% comment %}
	If this is a project page, append the appropriate table of contents.
{% endcomment %}
{% if path_array[0] == "projects" %}
	{% assign page_project = path_array[1] %}

	{% comment %}
    	Build array of projects.
	{% endcomment %}
	{% assign projects = "" | split: "" %}
	{% for the_page in site.pages %}
    	{% assign path_array = the_page.url | replace: "/", " " | strip | split: " " %}
    	{% assign path_size = path_array | size %}
    	{% if path_array[0] == "projects" and path_size == 2 %}
        	{% assign projects = projects | push: the_page %}
    	{% endif %}
	{% endfor %}

	{% comment %}
	    Build array of pages for this project.
	{% endcomment %}
	{% assign project_pages = "" | split: "" %}
	{% for the_page in site.pages %}
	    {% assign path_array = the_page.url | replace: "/", " " | strip | split: " " %}
	    {% assign path_size = path_array | size %}
	    {% if path_array[0] == "projects" and path_array[1] == page_project and path_size >= 3 %}
	        {% assign project_pages = project_pages | push: the_page %}
	    {% endif %}
	{% endfor %}
	{% assign project_pages = project_pages | sort: "name" | sort: "date" %}

	{% comment %}
		Project table of contents.
	{% endcomment %}
	<ul id="markdown-toc"><li>
		{% assign project_file = page_project | append: ".md" %}
		{% assign project = projects | where: "name", project_file | first %}
		<a href="/projects/{{ page_project }}/">{{ project.title }}</a>

		{% comment %}
			FIXME: The code below for determining the list of project pages
			to display is identical in all essential ways to the project
			page display code in `project.html`, and should be abstracted.
		{% endcomment %}
		{% if project_pages.size > 0 %}
			<ul>
				{% assign site_epoch = site.time | date: "%s" %}
				{% for pp in project_pages %}
					{% assign pp_epoch = pp.date | default: 0 | date: "%s" %}
					<li{% if pp_epoch > site_epoch and site.future != true %} class="o-40"{% endif %}>{% if pp.name == page.name %}<strong>{% elsif pp_epoch <= site_epoch or site.future == true %}<a href="{% if pp.original_link %}{{ pp.original_link }}{% else %}{{ pp.url }}{% endif %}">{% endif %}{{ pp.title }}{% if pp.name == page.name %}</strong>{% elsif pp_epoch <= site_epoch or site.future == true %}</a>{% endif %}</li>
				{% endfor %}
			</ul>
		{% endif %}
	</li></ul>
{% endif %}
