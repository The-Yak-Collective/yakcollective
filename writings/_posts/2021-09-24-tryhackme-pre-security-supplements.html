---
title: 'TryHackMe: Pre Security (Supplements)'
date: 2021-09-24 12:00:00.000000000 Z
layout: post-external
original_link: https://cardboard-iguana.com/log/2021-09-24-tryhackme-pre-security-supplements.html
author: 100007
---

<h1 id="tryhackme-pre-security-supplements">TryHackMe: Pre Security (Supplements)</h1>
<p><strong>author:</strong> Nathan Acks<br />
<strong>date:</strong> 2021-09-24</p>
<h1 id="core-windows-processes">Core Windows Processes</h1>
<h2 id="wininitexe">wininit.exe</h2>
<p>The “Windows Initialization Process”. Launches:</p>
<ul>
<li>Service Control Manager (services.exe)</li>
<li>Local Security Authority (lsass.exe)</li>
<li>Credential Guard and Key Guard (lsaiso.exe)</li>
</ul>
<p>The last of these in only run if “Credential Guard” is turned on.</p>
<p>All of these are system processes that live in session 0.</p>
<h2 id="wininitexe--servicesexe">wininit.exe &gt; services.exe</h2>
<p>The “Service Control Manager”, well, manages all services.</p>
<p>Service information lives in HKLM/System/CurrentControlSet/Services.</p>
<p>The Service Control Manager can be interacted with via the user-side utility sc.exe, or via the Services snap in services.msc.</p>
<p>The Service Control Manager is also responsible for loading (user-mode?) device drivers.</p>
<h2 id="wininitexe--servicesexe--svchostexe">wininit.exe &gt; services.exe &gt; svchost.exe</h2>
<p>Most built-in Windows services are actually DLLs that are hosted by the “Service Host”, svchost.exe. For services spawned in this way, svchost.exe loads the DLL specified in the ServiceDLL key of HKLM/SYSTEM/CurrentControlSet/Services/$&#x007b;SERVICE_NAME&#x007d;/Parameters.</p>
<p>On versions of Windows prior to Windows 10, as well as on Windows 10 with less than 3.5 GB of memory, multiple services are run by a single instance of svchost.exe. If Windows 10 has more than 3.5 GB of memory, however, it implements strong process isolation with each svchost.exe process hosting only a single service.</p>
<p>Services started with the same “key identifier” (-k switch) will share the same svchost.exe process; every copy of svchost.exe started by services.exe will use the -k parameter.</p>
<h2 id="lsassexe">lsass.exe</h2>
<p>The “Local Security Authority Subsystem Service” (lsass.exe) is in charge of enforcing system security policies:</p>
<ul>
<li>Verifies the user logging in;</li>
<li>Handles password changes;</li>
<li>Creates access tokens (for domain-joined machines using SAM, AD, and NETLOGON);</li>
<li>Writes the Windows security log.</li>
</ul>
<p>Authentication packages available to lsass.exe are specified in HKLM/System/CurrentControlSet/Control/Lsa.</p>
<p>This is the process targeted by mimikatz.</p>
<h2 id="winlogonexe">winlogon.exe</h2>
<p>The user-side counterpart for wininit.exe is winlogon.exe. Responsibilities:</p>
<ul>
<li>User logins (the login window?);</li>
<li>Loading the user profile;</li>
<li>The secure user prompt (Ctrl+Alt+Delete and presumably UAC prompts);</li>
<li>Screen locking.</li>
</ul>
<p>Loading the user profile on logon is handled by pushing the contents of NTUSER.DAT into HKCU (so NTUSER.DAT must be a registry file) and spawning the userinit.exe service (which handles spawning the user’s shell, and I’m guessing other user startup services, before self-terminating).</p>
<h2 id="explorerexe">explorer.exe</h2>
<p>The user’s shell is typically the Windows Explorer, which renders the desktop and task bar as well as providing the actual file explorer.</p>
<p>The user shell is defined in HKLM/Software/Microsoft/Windows NT/CurrentVersion/Winlogon/Shell.</p>